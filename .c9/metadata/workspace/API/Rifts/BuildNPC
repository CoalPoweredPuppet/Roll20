{"changed":true,"filter":false,"title":"BuildNPC","tooltip":"/API/Rifts/BuildNPC","value":"on('chat:message', function(msg) {\n    if (msg.type == 'api' && msg.content.indexOf('!build') !== -1) {\n        if (msg.selected == undefined) {\n            sendChat('', \"/desc No one selected\");\n            return;\n        }\n        var selected = msg.selected;\n        //----------loop tokens\n        i = 0;\n        _.each(selected, function(obj) {\n            var token = getObj('graphic', msg.selected[i]._id);\n            var MonsterName = token.get(\"name\");\n            var CheckSheet = findObjs({\n                _type: \"character\",\n                name: MonsterName\n            });\n            // DO NOT CREATE IF SHEET EXISTS\n            if (CheckSheet.length > 0) {\n                sendChat(\"ERROR\", \"This monster already exists.\");\n                return;\n            }\n            var Character = createObj(\"character\", {\n                avatar: token.get(\"imgsrc\"),\n                name: MonsterName,\n                archived: false\n            });\n            token.set(\"represents\", Character.id);\n            token.set(\"name\", MonsterName);\n            setatt(token, Character);\n            sendChat(\"DONE\", \"/w GM \" + \" created.\");\n            i++;\n        });\n    }\n});\n\nfunction setatt(token, Character) {\n\n    createObj(\"ability\", {\n        name: \"att1\",\n        description: \" \",\n        action: \"!attack --[[1d20+@{STRK}]] --[[1d6+@{DAM}]] --attA\",\n        istokenaction: true,\n        characterid: Character.id\n    });\n    var bar1m = parseInt(token.get(\"bar1_max\"));\n    var bar2m = parseInt(token.get(\"bar2_max\"));\n    token.set('flipv', !token.get('flipv'));\n    createObj(\"attribute\", {\n        name: \"A-BODY\",\n        current: bar1m,\n        max: bar1m,\n        characterid: Character.id\n    });\n    createObj(\"attribute\", {\n        name: \"HP\",\n        current: bar2m,\n        max: bar2m,\n        characterid: Character.id\n    });\n}\n\nfunction UnwrapString(stringname, separator, obj) {\n    var uArray = new Array();\n    var uString = \"\";\n    var gmnotes = decodeURI(obj.get('gmnotes'));\n    gmnotes = UnescapeString(gmnotes);\n    var startPos = gmnotes.indexOf(\"{\" + stringname + \"}\");\n    if (startPos == -1)\n        return {\n            uString: \"\",\n            uArray: uArray\n        };\n    var endPos = gmnotes.indexOf(\"{/\" + stringname + \"}\");\n    return {\n        uString: gmnotes.substr(startPos + stringname.length + 2, (endPos - startPos) - (stringname.length + 2)),\n        uArray: gmnotes.substr(startPos + stringname.length + 2, (endPos - startPos) - (stringname.length + 2)).split(separator)\n    };\n}\n\nfunction UnescapeString(dirtystring) {\n    dirtystring = dirtystring.replace(/%3A/g, ':');\n    dirtystring = dirtystring.replace(/%23/g, '#');\n    dirtystring = dirtystring.replace(/%3F/g, '?');\n    return dirtystring;\n}\n","undoManager":{"mark":-2,"position":5,"stack":[[{"start":{"row":0,"column":0},"end":{"row":38,"column":1},"action":"insert","lines":["on('chat:message', function(msg) {","    if(msg.type == 'api' && msg.content.indexOf('!build') !== -1) {","        if(msg.selected == undefined) {","            sendChat('', \"/desc No one selected\");","            return;","        }","        var selected = msg.selected;","        //----------loop tokens","        i = 0;","        _.each(selected, function(obj) {","            var token = getObj('graphic', msg.selected[i]._id);","            var MonsterName = token.get(\"name\");","            var CheckSheet = findObjs({_type: \"character\",name: MonsterName});","            // DO NOT CREATE IF SHEET EXISTS","            if(CheckSheet.length > 0) {","                sendChat(\"ERROR\", \"This monster already exists.\");","                return;","            }","            var Character = createObj(\"character\", {","                avatar: token.get(\"imgsrc\"),","                name: MonsterName,","                archived: false","            });","            token.set(\"represents\", Character.id);            ","            token.set(\"name\", MonsterName);","            setatt(token, Character);","            sendChat(\"DONE\", \"/w GM \" + \" created.\");","            i++;","        });","    }","});","function setatt(token, Character) {","    createObj(\"ability\", {name: \"att1\", description: \" \",action: \"!attack --[[1d20+@{STRK}]] --[[1d6+@{DAM}]] --attA\", istokenaction: true, characterid: Character.id});","    var bar1m = parseInt(token.get(\"bar1_max\"));","    var bar2m = parseInt(token.get(\"bar2_max\"));","    token.set('flipv', !token.get('flipv'));","    createObj(\"attribute\", {name: \"A-BODY\", current: bar1m, max: bar1m,characterid:  Character.id});","    createObj(\"attribute\", {name: \"HP\", current: bar2m, max: bar2m,characterid:  Character.id});","}"],"id":1}],[{"start":{"row":1,"column":6},"end":{"row":1,"column":7},"action":"insert","lines":[" "],"id":2},{"start":{"row":2,"column":10},"end":{"row":2,"column":11},"action":"insert","lines":[" "]},{"start":{"row":12,"column":39},"end":{"row":13,"column":16},"action":"insert","lines":["","                "]},{"start":{"row":13,"column":35},"end":{"row":14,"column":16},"action":"insert","lines":["","                "]},{"start":{"row":14,"column":33},"end":{"row":15,"column":12},"action":"insert","lines":["","            "]},{"start":{"row":17,"column":14},"end":{"row":17,"column":15},"action":"insert","lines":[" "]},{"start":{"row":26,"column":50},"end":{"row":26,"column":62},"action":"remove","lines":["            "]},{"start":{"row":34,"column":0},"end":{"row":35,"column":0},"action":"insert","lines":["",""]},{"start":{"row":36,"column":26},"end":{"row":37,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":37,"column":21},"end":{"row":38,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":38,"column":25},"end":{"row":39,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":39,"column":69},"end":{"row":40,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":40,"column":28},"end":{"row":41,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":41,"column":33},"end":{"row":42,"column":4},"action":"insert","lines":["","    "]},{"start":{"row":46,"column":28},"end":{"row":47,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":47,"column":23},"end":{"row":48,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":48,"column":23},"end":{"row":49,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":49,"column":19},"end":{"row":50,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":50,"column":20},"end":{"row":50,"column":21},"action":"remove","lines":[" "]},{"start":{"row":50,"column":33},"end":{"row":51,"column":4},"action":"insert","lines":["","    "]},{"start":{"row":52,"column":28},"end":{"row":53,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":53,"column":19},"end":{"row":54,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":54,"column":23},"end":{"row":55,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":55,"column":19},"end":{"row":56,"column":8},"action":"insert","lines":["","        "]},{"start":{"row":56,"column":20},"end":{"row":56,"column":21},"action":"remove","lines":[" "]},{"start":{"row":56,"column":33},"end":{"row":57,"column":4},"action":"insert","lines":["","    "]},{"start":{"row":58,"column":1},"end":{"row":59,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":35,"column":35},"end":{"row":36,"column":0},"action":"insert","lines":["",""],"id":3},{"start":{"row":36,"column":0},"end":{"row":36,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":59,"column":1},"end":{"row":60,"column":0},"action":"insert","lines":["",""],"id":5}],[{"start":{"row":60,"column":0},"end":{"row":76,"column":1},"action":"insert","lines":["function UnwrapString(stringname, separator, obj){","var uArray = new Array();","var uString = \"\";","var gmnotes = decodeURI(obj.get('gmnotes'));","gmnotes = UnescapeString(gmnotes);","var startPos = gmnotes.indexOf(\"{\" + stringname + \"}\");","if(startPos == -1)","return { uString: \"\", uArray: uArray };","var endPos = gmnotes.indexOf(\"{/\" + stringname + \"}\");","return { uString: gmnotes.substr(startPos+stringname.length+2, (endPos-startPos)-(stringname.length+2)), uArray: gmnotes.substr(startPos+stringname.length+2, (endPos-startPos)-(stringname.length+2)).split(separator) };","}","function UnescapeString(dirtystring){","dirtystring = dirtystring.replace(/%3A/g, ':');","dirtystring = dirtystring.replace(/%23/g, '#');","dirtystring = dirtystring.replace(/%3F/g, '?');","return dirtystring;","}"],"id":6}],[{"start":{"row":36,"column":0},"end":{"row":36,"column":4},"action":"remove","lines":["    "],"id":7},{"start":{"row":60,"column":0},"end":{"row":61,"column":0},"action":"insert","lines":["",""]},{"start":{"row":61,"column":49},"end":{"row":61,"column":50},"action":"insert","lines":[" "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":4},"action":"insert","lines":["    "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":4},"action":"insert","lines":["    "]},{"start":{"row":64,"column":0},"end":{"row":64,"column":4},"action":"insert","lines":["    "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":4},"action":"insert","lines":["    "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":4},"action":"insert","lines":["    "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":4},"action":"insert","lines":["    "]},{"start":{"row":67,"column":6},"end":{"row":67,"column":7},"action":"insert","lines":[" "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":8},"action":"insert","lines":["        "]},{"start":{"row":68,"column":16},"end":{"row":69,"column":11},"action":"insert","lines":["","           "]},{"start":{"row":69,"column":24},"end":{"row":70,"column":11},"action":"insert","lines":["","           "]},{"start":{"row":70,"column":26},"end":{"row":71,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":72,"column":0},"end":{"row":72,"column":4},"action":"insert","lines":["    "]},{"start":{"row":73,"column":0},"end":{"row":73,"column":4},"action":"insert","lines":["    "]},{"start":{"row":73,"column":12},"end":{"row":74,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":74,"column":40},"end":{"row":74,"column":41},"action":"insert","lines":[" "]},{"start":{"row":74,"column":42},"end":{"row":74,"column":43},"action":"insert","lines":[" "]},{"start":{"row":74,"column":60},"end":{"row":74,"column":61},"action":"insert","lines":[" "]},{"start":{"row":74,"column":62},"end":{"row":74,"column":63},"action":"insert","lines":[" "]},{"start":{"row":74,"column":73},"end":{"row":74,"column":74},"action":"insert","lines":[" "]},{"start":{"row":74,"column":75},"end":{"row":74,"column":76},"action":"insert","lines":[" "]},{"start":{"row":74,"column":85},"end":{"row":74,"column":86},"action":"insert","lines":[" "]},{"start":{"row":74,"column":87},"end":{"row":74,"column":88},"action":"insert","lines":[" "]},{"start":{"row":74,"column":106},"end":{"row":74,"column":107},"action":"insert","lines":[" "]},{"start":{"row":74,"column":108},"end":{"row":74,"column":109},"action":"insert","lines":[" "]},{"start":{"row":74,"column":113},"end":{"row":75,"column":7},"action":"insert","lines":["","       "]},{"start":{"row":75,"column":39},"end":{"row":75,"column":40},"action":"insert","lines":[" "]},{"start":{"row":75,"column":41},"end":{"row":75,"column":42},"action":"insert","lines":[" "]},{"start":{"row":75,"column":59},"end":{"row":75,"column":60},"action":"insert","lines":[" "]},{"start":{"row":75,"column":61},"end":{"row":75,"column":62},"action":"insert","lines":[" "]},{"start":{"row":75,"column":72},"end":{"row":75,"column":73},"action":"insert","lines":[" "]},{"start":{"row":75,"column":74},"end":{"row":75,"column":75},"action":"insert","lines":[" "]},{"start":{"row":75,"column":84},"end":{"row":75,"column":85},"action":"insert","lines":[" "]},{"start":{"row":75,"column":86},"end":{"row":75,"column":87},"action":"insert","lines":[" "]},{"start":{"row":75,"column":105},"end":{"row":75,"column":106},"action":"insert","lines":[" "]},{"start":{"row":75,"column":107},"end":{"row":75,"column":108},"action":"insert","lines":[" "]},{"start":{"row":75,"column":128},"end":{"row":76,"column":3},"action":"insert","lines":["","   "]},{"start":{"row":77,"column":1},"end":{"row":78,"column":0},"action":"insert","lines":["",""]},{"start":{"row":79,"column":36},"end":{"row":79,"column":37},"action":"insert","lines":[" "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":4},"action":"insert","lines":["    "]},{"start":{"row":81,"column":0},"end":{"row":81,"column":4},"action":"insert","lines":["    "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":4},"action":"insert","lines":["    "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":4},"action":"insert","lines":["    "]}]]},"ace":{"folds":[],"scrolltop":234,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":85,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":15,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1487016236631}