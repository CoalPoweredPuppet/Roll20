{"filter":false,"title":"Combat-Rolls","tooltip":"/API/Combat-Rolls","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":29,"column":2},"end":{"row":29,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":30,"column":2},"end":{"row":30,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":2},"end":{"row":31,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":2},"end":{"row":32,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":2},"end":{"row":33,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":2},"end":{"row":34,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":2},"end":{"row":35,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":2},"end":{"row":37,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":2},"end":{"row":38,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":2},"end":{"row":39,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":2},"end":{"row":40,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":2},"end":{"row":41,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":2},"end":{"row":42,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":2},"end":{"row":43,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":52},"end":{"row":0,"column":59},"action":"insert","lines":["bShadow"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":59},"end":{"row":0,"column":60},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":60},"end":{"row":0,"column":64},"action":"insert","lines":["font"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":64},"end":{"row":0,"column":65},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":54,"column":57},"end":{"row":54,"column":58},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":3},"end":{"row":64,"column":7},"action":"remove","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":67,"column":5},"end":{"row":67,"column":8},"action":"remove","lines":["ar "]}]}],[{"group":"doc","deltas":[{"start":{"row":67,"column":4},"end":{"row":67,"column":5},"action":"remove","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":18},"end":{"row":70,"column":19},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":281,"column":3},"action":"remove","lines":["on('chat:message', function (msg) {","    if (msg.type != \"api\") return;","\tvar msgTxt = msg.content;","\tvar command = msg.content.split(\" \", 1);\t","\tvar cWho = findObjs({_type: 'character',name: msg.who})[0];","\tif (cWho === undefined && msg.who.indexOf(\"(GM)\") == -1) {","\t\tcWho = RollRight(msg.playerid);","\t\tmsg.who = cWho.get(\"name\");","\t}","\t/*-----------","START","-----------*/    ","\tif (command == \"!attack\") {","\t\tvar who = msg.who;","\t\tmsg.content = MakeRollNum(msg.content, msg.inlinerolls);","//\t\tcheck rolls---------------------","\t\tvar ar = msg.inlinerolls[0];","\t\tvar dr = msg.inlinerolls[1];","//\t\tdefine var----------------------        ","\t\tif (ar === undefined || dr === undefined) {","\t\t\tsendChat('', \"/direct <B><I>bad macro!\"); ","\t\t\treturn;","\t\t}","\t\tmsgFormula = msgTxt.split(\" --\");","\t\tvar Saycolor = \"#964141\";","\t\tvar Lucky = 20;","\t\tvar failRange = 1;","\t\tvar dParts = \"\";","\t\tvar dRoll = \"\";","\t\tvar DD = \"\";","\t\tvar bText = \"\";","\t\tvar DDtext = \"\";","\t\tvar bg_crit = \"\";","\t\tvar fumble = 0;","\t\tvar boxcolor = getObj(\"player\", msg.playerid).get(\"color\");","\t\tif (msg.who == \"GM (GM)\") {boxcolor = '#831F29';who = \"NPC\";}","\t\tvar topimg = \"https://s3.amazonaws.com/files.staging.d20.io/images/181118/cN5ui3MXx87UBgVUgzwYTQ/med.jpg?141868063\";","\t\tvar tshadow2 = \"-1px -1px #444, 1px -1px #444, -1px 1px #444, 1px 1px #444\";","\t\tvar SayParts = \"<div style='text-shadow: 1px 1px #000, -1px -1px #000, -1px 1px #000, 1px -1px #000; margin: 0em 0em 0em 0em;; font-size:8pt; display:inline-block; text-align: center; vertical-align:middle; padding: 0px 6px 0px 6px; border: 1px solid #000; border-radius: 3px; color: #FFF; background-image: url(\"+topimg+\");'>\";","\t\tvar MainSay = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family:\" + font + \"; font-size: x-small; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color:#CEC7B6; color: #000;'>\";","\t\tvar MainEven = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family: \" + font + \"; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color: #CEC7B6; color: #000;'>\";","\t\tvar MainOdd = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family: \" + font + \"; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color: #C0B9A8; color: #000;'>\";","\t\tvar RollParts = \"<div style='margin: 0em 0.1em 0.1em 0em; font-size: 10pt; text-shadow: \"+tshadow2+\"; width: 15px; height: 15px; line-height: 15px; display:inline-block; text-align:center; padding: 0px 1px 0px 0px; border: 1px solid #000; border-radius: 3px; color: #FFF;\";","\t\t/*-----------","START2","-----------*/","//\t\tset motto","\t\tif (msgFormula[3] !== undefined) {","\t\t\tvar ammoleng = msgFormula[3].length - 1;","\t\t\tvar sayingCheck = parseInt(msgFormula[3].substr(ammoleng));","\t\t\tif (isNaN(sayingCheck)) {","\t\t\t\tCustom = msgFormula[3].toUpperCase();","\t\t\t}","\t\t\telse if (msgFormula[3] !== undefined && msgFormula[4] === undefined) {                ","\t\t\t\tCustom = msgFormula[3].toUpperCase();","\t\t\t\tvar gunleng = msgFormula[3].length - 2;","\t\t\t\tvar Custom = msgFormula[3].substr(0, gunleng).toUpperCase();","\t\t\t}","\t\t}","\t\telse{Custom = \"ATTACK:\";}","//\t\tCheck for GUN","\t\tif (msgFormula[4] === undefined) msgFormula[4] = msgFormula[3];","\t\tif (msgFormula[4] !== undefined  && who !== \"NPC\"){","\t\t\tammoleng = msgFormula[4].length - 1;","\t\t\tvar ammo = parseInt(msgFormula[4].substr(ammoleng));","\t\t\tif (!isNaN(ammo)) {","\t\t\t\tgunleng = msgFormula[4].length - 2;","\t\t\t\tvar gun = msgFormula[4].substr(0, gunleng);","\t\t\t\tvar FindGun = findObjs({current: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\t\tif (FindGun === undefined){","\t\t\t\t\tFindGun = findObjs({name: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\t\t}","\t\t\t\tif(FindGun == undefined) {","\t\t\t\t\tsendChat('Error', \"/desc test You do not own a  \"+ gun);","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\tvar attName = FindGun.get(\"name\");","\t\t\t\tvar leng = attName.length - 5;","\t\t\t\tvar res = attName.substr(leng, 5);","\t\t\t\tleng = attName.substr(0, leng);","\t\t\t\tvar ammo0 = findObjs({name: leng + \"_WEAPpay\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];              ","\t\t\t\t//var bonus = findObjs({name: leng + \"_WEAPb\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var bonus = parseInt(bonus.get(\"current\"));","                //var damage = findObjs({name: leng + \"_WEAPd\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var damage = damage.get(\"current\");","                if (ammo0 == undefined){","\t\t\t\t\tammo0 = FindGun","\t\t\t\t}","\t\t\t}","\t\t}","\t\t/*-----------","ATTACK PARTS","-----------*/","//\t\t--Attack Modifier","\t\tif (ar.results.rolls[1] === undefined) mod = \"\";","\t\telse mod = (ar.results.rolls[1].expr);","\t\taRollraw = ar.results.rolls[0].results[0]['v'];","\t\t//Attack total and type","\t\tAtotal = (ar.results.total);","\t\tAtype = \"<a style='color:RED'>\" + ar.expression + \"</a>\";","//\t\tDAMAGE PARTS-----------------","//\t\t--Damage modifier","\t\tif (dr.results.rolls[1] === undefined) dMod = \"\";","\t\telse dMod = (dr.results.rolls[1].expr);","//\t\t--Set damage total","\t\tDtotal = dr.results.total;","//\t\t--Make damage text for all rolls","\t\tdam = dr.results.rolls[0];","\t\tdamsort = dam.results;","\t\tvar i = 0;","\t\t//damsort.sort(function(a, b){return a.v < b.v;});","\t\twhile (dam.results[i] !== undefined) {","\t\t\tdNum = dam.results[i]['v'];","\t\t\tddimg = \"http://image.blingee.com.s3.amazonaws.com/images19/content/output/000/000/000/061/788808721_1076628.gif?4\";","\t\t\tbg_max = \"background-position:center; background-image: url(\"+ddimg+\");\";","\t\t\tif (dNum == 1) num = RollParts + \"background-color:#A80000;'>\" + dNum + \"</div></b></a>\";","\t\t\telse if (dNum == dr.results.rolls[0].sides) num = RollParts + \"background-color:#00A120;\"+bg_max+\"'><b>\" + dNum + \"</b></div></b></a>\";","\t\t\telse num = RollParts + \"background-color:#696969;'>\" + dNum + \"</div>\";","\t\t\tdRoll = dRoll + \"\" + (num);","\t\t\ti++;","\t\t}","\t\tDtype = \"<a style='color:RED;'>\" + dr.expression + \"</a>\";","\t\tdRoll = dRoll + \"<b>\"+dMod+\"</b>\";","//\t\t--Set Double Damage","\t\tif (aRollraw >= 20) {","\t\t\tDtotal = \"<a style='color:RED'><strong style='font-size: 110%;'>\" + Dtotal * 2 + \"!</strong></a>\";","\t\t\tAtotal = \"<a style='color:RED'><strong style='font-size: 110%;'>\" + Atotal + \"!</strong></a>\";","\t\t\tbText = bText + \" \" + '<b>DOUBLE DAMAGE!</b><BR><b>(NATURAL 20!)</b>';","\t\t\tbg_crit = \"background-position:center; background-image: url(\"+crit_img+\");\";","\t\t}","//\t\t--Set Miss","\t\tif (aRollraw <= 3) {","\t\t\tnum = RollParts + \"background-color:#A80000;'>\" + aRollraw + \"</div>\";","\t\t\tDtotal = \"<a style='color:#000'>\" + Dtotal + \"!</a>\";","\t\t\tAtotal = \"<a style='color:#000'>\" + Atotal + \"!</a>\";","\t\t\tbText = bText + \" \" + 'MISS';","\t\t\tboxcolor = \"#bbb\";","\t\t\tSaycolor = \"#555\";","\t\t}","\t\telse num = RollParts + \"background-color:#696969;'>\" + aRollraw + \"</div>\";","\t\taRoll = num;","//\t\tCHATBOX PARTS----------------        ","\t\tMain = MainSay + SayParts +  \"<b><i>●\" + Custom + \"●</i></b></div></div>\";","\t\tMain = Main + MainOdd + Atype + \" <b>To Hit: </b>\" + aRoll + \"<b>\" + mod + \" = <a style='color:BLUE'>\" + Atotal + \"</b></a></div>\";","\t\tMain = Main + MainEven + Dtype + \"<b> Damage:<br></b>\" + dRoll + \"<b> = <a style='color:BLUE'>\" + Dtotal + \"</b></a></div>\";","//\t\tCRIT_FUMBLE PARTS----------------","//\t\t--CRIT roll","\t\taRollraw1 = randomInteger(Lucky);","\t\tif (aRollraw1 >= Lucky && aRollraw > 4) {","\t\t\tMain = Main + MainOdd + \"<a style = 'color:PURPLE'><b>Lucky Shot!: \" + aLoc[Math.floor(Math.random() * aLoc.length)] + \"</b></div>\";","\t\t\tbg_crit = \"background-position:50% 54%; background-image: url(http:\\\\//i.imgur.com/cFiEs5R.gif);\";","\t\t\tbText = bText + \" \" + SayParts +  \"<b><i>●LUCKY SHOT●</i></b></div></div>\";;","//\t\t\t--FAIL roll","\t\t} ","\t\tif (aRollraw <= failRange) {","\t\t\tMain = Main + MainOdd + \"<a style = 'color:PURPLE'><b>Fumble!: \" + aFum[Math.floor(Math.random() * aFum.length)] + \"</div>\";","\t\t\tbg_crit = \"background-position:50% 54%; background-image: url(\"+fail_img+\");\";","\t\t\tbText = bText + \" \" +'FUMBLE';","\t\t\tfumble = 1;","\t\t}","\t\t/*-----------","AMMO PARTS","-----------*/","\t\tif (FindGun !== undefined  && who !== \"NPC\" && ammo0 !== undefined) {","\t\t\tvar ammoleng = msgFormula[4].length - 1;","\t\t\tvar ammo = parseInt(msgFormula[4].substr(ammoleng));","\t\t\tvar ammoC = parseInt(ammo);","\t\t\tif(ammoC === undefined || isNaN(ammoC)) ammoC = 1;","            //var acAbilityAttribute = getAttrByName(cWho.id, 'ISP'); // \"@{strength-mod}\"","            //log(acAbilityAttribute);","\t\t\tvar cAmmo = parseInt(ammo0.get(\"current\"));","\t\t\tvar mAmmo = parseInt(ammo0.get(\"max\"));","\t\t\tif (isNaN(cAmmo) || isNaN(mAmmo)) {","\t\t\t\tsendChat('Error', \"/desc Set ammo for  \"+ gun);","\t\t\t\treturn;","\t\t\t}","\t\t\tvar curPageID = findObjs({_type: \"campaign\"})[0].get(\"playerpageid\");","\t\t\tvar curPage = findObjs({_type: \"page\", _id: curPageID})[0];","\t\t\tvar charObj = findObjs({ type: 'character', controlledby: msg.playerid })[0];","\t\t\tvar tokens = findObjs({_type: \"graphic\", layer:\"objects\", _pageid: curPageID, represents: charObj.id});","\t\t\t_.each(tokens, function(id) {","\t\t\t\tvar who = getObj('character', id.get(\"represents\"));","\t\t\t\tvar aSet = findObjs({_type: \"attribute\",name: leng + \"_WEAPpay\",_characterid: cWho.id} , {caseInsensitive: true})[0];","\t\t\t\tif (aSet == undefined){","\t\t\t\t\taSet = FindGun;","\t\t\t\t}","\t\t\t\taSet = aSet.id;","\t\t\t\tid.set(\"bar3_link\", aSet);","\t\t\t\tid.set('bar3_value', cAmmo);","\t\t\t\tid.set('bar3_max', mAmmo);","\t\t\t});","\t\t\tvar aPart = \"<div style='box-shadow: \"+bShadow+\"; font-family: \"+font+\"; font-size: 8pt; text-align: center; margin:0px; padding:0px 0px 0px 0px; border-left: 1px solid #000; border-right: 1px solid #000; border-top: 1px solid #000; border-radius: 0px; color: #000;\";","\t\t\tif (mAmmo == 0) {}","\t\t\telse if (cAmmo <= 0 || cAmmo < ammoC) {","\t\t\t\tcAmmo = \"0\";","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tMain = aPart + \"background-color:RED;'><b><i>Not Enough \" + gun + \" ammo left in clip.</div>\";","\t\t\t}","\t\t\telse if (cAmmo <= 3 || cAmmo < ammoC) {","\t\t\t\tcAmmo = cAmmo - ammoC;","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tvar per = (cAmmo/mAmmo)*100;","\t\t\t\tvar ammoT = '<div style=\"border: 2px solid #333; background-color: #0D0D0D; border-radius: 13px; padding: 3px;\"><div style=\"background-color: red; width: '+per+'%; height: 5px; border-radius: 10px;\"></div></div>';","\t\t\t\tMain = Main + aPart + \"background-color:RED;'><b><i>\" + cAmmo + \" \" + gun + \" ammo left in clip.</b></i>\"+ammoT+\"</div>\";","\t\t\t} ","\t\t\telse {","\t\t\t\tcAmmo = cAmmo - ammoC;","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tvar per = (cAmmo/mAmmo)*100;","\t\t\t\tvar ammoT = '<div style=\"border: 2px solid #333; background-color: #0D0D0D; border-radius: 13px; padding: 1px;\"><div style=\"background-color: orange; width: '+per+'%; height: 3px; border-radius: 10px; margins: 0px;\"></div></div>';","\t\t\t\tMain = Main + aPart + \"background-color:#A8A191;'><b><i>\" + cAmmo + \" of \" + mAmmo + \" \" + gun + \" ammo left</b></i>\"+ammoT+\"</div>\";","\t\t\t}","\t\t}","\t\t/*-----------","SEND CHAT","-----------*/","\t\tvar pad = \"6px;\";","\t\tif (bText != \"\") pad = \"2px;\";","\t\tvar top = \"<div style='\"+bg_crit+\" box-shadow: \"+bShadow+\"; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 2px 2px #000; font-family: \"+font+\"; text-align: center; vertical-align: middle; padding: 0px 0px; margin-top: 0.2em; border: 1px solid #000; border-radius: 10px 10px 0px 0px; color: #FFFFFF; background-color:\" + boxcolor + \";'><b>\" + who + \"  Attacks</b></div>\";","\t\tEnd = \"<div style='\"+bg_crit+\" box-shadow: \"+bShadow+\"; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 2px 2px #000; font-family: \"+font+\"; font-size: 16px ;text-align: center; padding: \"+pad+\" vertical-align: middle; border: 1px solid #000; border-radius: 0px 0px 8px 8px; color: #FFFFFF; background-color:\" + boxcolor+ \";'><b>\"  + bText + \"</div>\";","\t\tvar SendT = top + Main + End;","\t\tif (aRollraw <= 3 && fumble != 1) {","\t\t\tSendT = \"<div style='opacity: 0.5;'><strong style='font-size: 70%;'>\" + SendT + \"</strong></div>\";","\t\t}","\t\tif (aRollraw >=20) {","\t\t\tSendT = \"<strong style='font-size: 120%;'>\" + SendT + \"</strong>\";","\t\t}","\t\tsendChat(who, '/direct ' + SendT);","\t\treturn;","\t}","//\t-----------------------------","//\tRELOAD----------------","//\t-----------------------------","\tif (command == \"!reload\") {","\t\tif (cWho !== undefined) {","\t\t\tvar msgFormula = msgTxt.split(\" --\");","\t\t\tvar gun = msgFormula[1];","\t\t\tvar FindGun = findObjs({current: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tif (FindGun == undefined) {","\t\t\t\tsendChat('', '/desc '+msg.who+': <b>ammo not found</b>');","\t\t\t\treturn","\t\t\t}","\t\t\tClips = 0;","\t\t\tvar attName = FindGun.get(\"name\");","\t\t\tvar Ammo0 = findObjs({name: attName + \"pay\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tvar Ammo1 = findObjs({name: attName + \"Rounds\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tvar Clipsc = findObjs({name: attName + \"clip\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tif(Clipsc != undefined) {","\t\t\t\tvar Clips = parseInt(Clipsc.get(\"current\"));                ","\t\t\t}","\t\t\tvar cWep = parseInt(Ammo0.get(\"current\"));","\t\t\tvar mWep = parseInt(Ammo0.get(\"max\"));","\t\t\tvar cAmmo = parseInt(Ammo1.get(\"current\"));","\t\t\tif (cAmmo <= 0) {","\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>● \" +msg.who+ ' NO AMMO TO RELOAD!</div>';","\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t}","\t\t\telse {                ","\t\t\t\tvar needed = mWep - cWep;                ","\t\t\t\tif(needed >= cAmmo) {needed = cAmmo;}","\t\t\t\tif (Clips == 10) {","\t\t\t\t\tneeded = 1;","\t\t\t\t\tcAmmo = cAmmo - needed;","\t\t\t\t\tvar reloads = cAmmo;","\t\t\t\t\tAmmo0.set('current', mWep);","\t\t\t\t\tAmmo1.set('current', cAmmo);","\t\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>● \" +msg.who+ ' is reloading: '+needed +\" clips on:<br>● \"+ msgFormula[1] +' ●<br>'+ cAmmo + ' left(' + reloads + 'Clips)</div>';","\t\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t\t}","\t\t\t\telse {","\t\t\t\t\tcAmmo = cAmmo - needed;","\t\t\t\t\tvar reloads = Math.round((cAmmo / mWep) * 10) / 10;\t\t\t\t","\t\t\t\t\tAmmo0.set('current', cWep+needed);","\t\t\t\t\tAmmo1.set('current', cAmmo);","\t\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>\" +msg.who+ ' is reloading '+needed +\" Ammo on:<br>● \"+ msgFormula[1] +' ●<br>'+ cAmmo + ' left(' + reloads + ' reloads)</div>';","\t\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t\t}","\t\t\t}","\t\t}","\t}","});"]},{"start":{"row":1,"column":0},"end":{"row":282,"column":3},"action":"insert","lines":["//!attack --[[1d20]] --[[3d6]] --saying! --ammotype","on('chat:message', function (msg) {","    if (msg.type != \"api\") return;","\tvar msgTxt = msg.content;","\tvar command = msg.content.split(\" \", 1);\t","\tvar cWho = findObjs({_type: 'character',name: msg.who})[0];","\tif (cWho == undefined && msg.who.indexOf(\"(GM)\") == -1) {","\t\tcWho = RollRight(msg.playerid);","\t\tmsg.who = cWho.get(\"name\");","\t}","\t/*-----------","START","-----------*/    ","\tif (command == \"!attack\") {","\t\twho = msg.who;","\t\tmsg.content = MakeRollNum(msg.content, msg.inlinerolls);","//\t\tcheck rolls---------------------","\t\tar = msg.inlinerolls[0];","\t\tdr = msg.inlinerolls[1];","//\t\tdefine var----------------------        ","\t\tif (ar === undefined || dr === undefined) {","\t\t\tsendChat('', \"/direct <B><I>bad macro!\"); ","\t\t\treturn;","\t\t}","\t\tmsgFormula = msgTxt.split(\" --\");","\t\tSaycolor = \"#964141\";","\t\tLucky = 20;","\t\tfailRange = 1;","\t\tdParts = \"\";","\t\tdRoll = \"\";","\t\tDD = \"\";","\t\tbText = \"\";","\t\tDDtext = \"\";","\t\tbg_crit = \"\";","\t\tfumble = 0;","\t\tboxcolor = getObj(\"player\", msg.playerid).get(\"color\");","\t\tif (msg.who == \"GM (GM)\") {boxcolor = '#831F29';who = \"NPC\";}","\t\ttopimg = \"https://s3.amazonaws.com/files.staging.d20.io/images/181118/cN5ui3MXx87UBgVUgzwYTQ/med.jpg?141868063\";","\t\ttshadow2 = \"-1px -1px #444, 1px -1px #444, -1px 1px #444, 1px 1px #444\";","\t\tSayParts = \"<div style='text-shadow: 1px 1px #000, -1px -1px #000, -1px 1px #000, 1px -1px #000; margin: 0em 0em 0em 0em;; font-size:8pt; display:inline-block; text-align: center; vertical-align:middle; padding: 0px 6px 0px 6px; border: 1px solid #000; border-radius: 3px; color: #FFF; background-image: url(\"+topimg+\");'>\";","\t\tMainSay = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family:\" + font + \"; font-size: x-small; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color:#CEC7B6; color: #000;'>\";","\t\tMainEven = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family: \" + font + \"; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color: #CEC7B6; color: #000;'>\";","\t\tMainOdd = \"<div style='box-shadow: \"+bShadow+\"; text-shadow: 1px 1px #878787; font-family: \" + font + \"; text-align: center; vertical-align: middle; padding: 1px; border-left: 1px solid #000; border-right: 1px solid #000; border-radius: 0px; background-color: #C0B9A8; color: #000;'>\";","\t\tRollParts = \"<div style='margin: 0em 0.1em 0.1em 0em; font-size: 10pt; text-shadow: \"+tshadow2+\"; width: 15px; height: 15px; line-height: 15px; display:inline-block; text-align:center; padding: 0px 1px 0px 0px; border: 1px solid #000; border-radius: 3px; color: #FFF;\";","\t\t/*-----------","START2","-----------*/","//\t\tset motto","\t\tif (msgFormula[3] !== undefined) {","\t\t\tvar ammoleng = msgFormula[3].length - 1;","\t\t\tvar sayingCheck = parseInt(msgFormula[3].substr(ammoleng));","\t\t\tif (isNaN(sayingCheck)) {","\t\t\t\tCustom = msgFormula[3].toUpperCase();","\t\t\t}","\t\t\telse if (msgFormula[3] !== undefined && msgFormula[4] == undefined) {                ","\t\t\t\tCustom = msgFormula[3].toUpperCase();","\t\t\t\tvar gunleng = msgFormula[3].length - 2;","\t\t\t\tvar Custom = msgFormula[3].substr(0, gunleng).toUpperCase();","\t\t\t}","\t\t}","\t\telse{Custom = \"ATTACK:\";}","//\t\tCheck for GUN","\t\tif (msgFormula[4] === undefined) msgFormula[4] = msgFormula[3];","\t\tif (msgFormula[4] !== undefined  && who !== \"NPC\"){","\t\t\tvar ammoleng = msgFormula[4].length - 1;","\t\t\tvar ammo = parseInt(msgFormula[4].substr(ammoleng));","\t\t\tif (!isNaN(ammo)) {","\t\t\t\tvar gunleng = msgFormula[4].length - 2;","\t\t\t\tvar gun = msgFormula[4].substr(0, gunleng);","\t\t\t\tvar FindGun = findObjs({current: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\t\tif (FindGun == undefined){","\t\t\t\t\tFindGun = findObjs({name: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\t\t}","\t\t\t\tif(FindGun == undefined) {","\t\t\t\t\tsendChat('Error', \"/desc test You do not own a  \"+ gun);","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\tvar attName = FindGun.get(\"name\");","\t\t\t\tvar leng = attName.length - 5;","\t\t\t\tvar res = attName.substr(leng, 5);","\t\t\t\tleng = attName.substr(0, leng);","\t\t\t\tvar ammo0 = findObjs({name: leng + \"_WEAPpay\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];              ","\t\t\t\t//var bonus = findObjs({name: leng + \"_WEAPb\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var bonus = parseInt(bonus.get(\"current\"));","                //var damage = findObjs({name: leng + \"_WEAPd\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var damage = damage.get(\"current\");","                if (ammo0 == undefined){","\t\t\t\t\tammo0 = FindGun","\t\t\t\t}","\t\t\t}","\t\t}","\t\t/*-----------","ATTACK PARTS","-----------*/","//\t\t--Attack Modifier","\t\tif (ar.results.rolls[1] === undefined) mod = \"\";","\t\telse mod = (ar.results.rolls[1].expr);","\t\taRollraw = ar.results.rolls[0].results[0]['v'];","\t\t//Attack total and type","\t\tAtotal = (ar.results.total);","\t\tAtype = \"<a style='color:RED'>\" + ar.expression + \"</a>\";","//\t\tDAMAGE PARTS-----------------","//\t\t--Damage modifier","\t\tif (dr.results.rolls[1] === undefined) dMod = \"\";","\t\telse dMod = (dr.results.rolls[1].expr);","//\t\t--Set damage total","\t\tDtotal = dr.results.total;","//\t\t--Make damage text for all rolls","\t\tdam = dr.results.rolls[0];","\t\tdamsort = dam.results;","\t\tvar i = 0;","\t\t//damsort.sort(function(a, b){return a.v < b.v;});","\t\twhile (dam.results[i] !== undefined) {","\t\t\tdNum = dam.results[i]['v'];","\t\t\tddimg = \"http://image.blingee.com.s3.amazonaws.com/images19/content/output/000/000/000/061/788808721_1076628.gif?4\";","\t\t\tbg_max = \"background-position:center; background-image: url(\"+ddimg+\");\";","\t\t\tif (dNum == 1) num = RollParts + \"background-color:#A80000;'>\" + dNum + \"</div></b></a>\";","\t\t\telse if (dNum == dr.results.rolls[0].sides) num = RollParts + \"background-color:#00A120;\"+bg_max+\"'><b>\" + dNum + \"</b></div></b></a>\";","\t\t\telse num = RollParts + \"background-color:#696969;'>\" + dNum + \"</div>\";","\t\t\tdRoll = dRoll + \"\" + (num);","\t\t\ti++;","\t\t}","\t\tDtype = \"<a style='color:RED;'>\" + dr.expression + \"</a>\";","\t\tdRoll = dRoll + \"<b>\"+dMod+\"</b>\";","//\t\t--Set Double Damage","\t\tif (aRollraw >= 20) {","\t\t\tDtotal = \"<a style='color:RED'><strong style='font-size: 110%;'>\" + Dtotal * 2 + \"!</strong></a>\";","\t\t\tAtotal = \"<a style='color:RED'><strong style='font-size: 110%;'>\" + Atotal + \"!</strong></a>\";","\t\t\tbText = bText + \" \" + '<b>DOUBLE DAMAGE!</b><BR><b>(NATURAL 20!)</b>';","\t\t\tbg_crit = \"background-position:center; background-image: url(\"+crit_img+\");\";","\t\t}","//\t\t--Set Miss","\t\tif (aRollraw <= 3) {","\t\t\tnum = RollParts + \"background-color:#A80000;'>\" + aRollraw + \"</div>\";","\t\t\tDtotal = \"<a style='color:#000'>\" + Dtotal + \"!</a>\";","\t\t\tAtotal = \"<a style='color:#000'>\" + Atotal + \"!</a>\";","\t\t\tbText = bText + \" \" + 'MISS';","\t\t\tboxcolor = \"#bbb\";","\t\t\tSaycolor = \"#555\";","\t\t}","\t\telse num = RollParts + \"background-color:#696969;'>\" + aRollraw + \"</div>\";","\t\taRoll = num;","//\t\tCHATBOX PARTS----------------        ","\t\tMain = MainSay + SayParts +  \"<b><i>●\" + Custom + \"●</i></b></div></div>\";","\t\tMain = Main + MainOdd + Atype + \" <b>To Hit: </b>\" + aRoll + \"<b>\" + mod + \" = <a style='color:BLUE'>\" + Atotal + \"</b></a></div>\";","\t\tMain = Main + MainEven + Dtype + \"<b> Damage:<br></b>\" + dRoll + \"<b> = <a style='color:BLUE'>\" + Dtotal + \"</b></a></div>\";","//\t\tCRIT_FUMBLE PARTS----------------","//\t\t--CRIT roll","\t\taRollraw1 = randomInteger(Lucky);","\t\tif (aRollraw1 >= Lucky && aRollraw > 4) {","\t\t\tMain = Main + MainOdd + \"<a style = 'color:PURPLE'><b>Lucky Shot!: \" + aLoc[Math.floor(Math.random() * aLoc.length)] + \"</b></div>\";","\t\t\tbg_crit = \"background-position:50% 54%; background-image: url(http:\\\\//i.imgur.com/cFiEs5R.gif);\";","\t\t\tbText = bText + \" \" + SayParts +  \"<b><i>●LUCKY SHOT●</i></b></div></div>\";;","//\t\t\t--FAIL roll","\t\t} ","\t\tif (aRollraw <= failRange) {","\t\t\tMain = Main + MainOdd + \"<a style = 'color:PURPLE'><b>Fumble!: \" + aFum[Math.floor(Math.random() * aFum.length)] + \"</div>\";","\t\t\tbg_crit = \"background-position:50% 54%; background-image: url(\"+fail_img+\");\";","\t\t\tbText = bText + \" \" +'FUMBLE';","\t\t\tfumble = 1;","\t\t}","\t\t/*-----------","AMMO PARTS","-----------*/","\t\tif (FindGun !== undefined  && who !== \"NPC\" && ammo0 !== undefined) {","\t\t\tvar ammoleng = msgFormula[4].length - 1;","\t\t\tvar ammo = parseInt(msgFormula[4].substr(ammoleng));","\t\t\tvar ammoC = parseInt(ammo);","\t\t\tif(ammoC === undefined || isNaN(ammoC)) ammoC = 1;","            //var acAbilityAttribute = getAttrByName(cWho.id, 'ISP'); // \"@{strength-mod}\"","            //log(acAbilityAttribute);","\t\t\tvar cAmmo = parseInt(ammo0.get(\"current\"));","\t\t\tvar mAmmo = parseInt(ammo0.get(\"max\"));","\t\t\tif (isNaN(cAmmo) || isNaN(mAmmo)) {","\t\t\t\tsendChat('Error', \"/desc Set ammo for  \"+ gun);","\t\t\t\treturn;","\t\t\t}","\t\t\tvar curPageID = findObjs({_type: \"campaign\"})[0].get(\"playerpageid\");","\t\t\tvar curPage = findObjs({_type: \"page\", _id: curPageID})[0];","\t\t\tvar charObj = findObjs({ type: 'character', controlledby: msg.playerid })[0];","\t\t\tvar tokens = findObjs({_type: \"graphic\", layer:\"objects\", _pageid: curPageID, represents: charObj.id});","\t\t\t_.each(tokens, function(id) {","\t\t\t\tvar who = getObj('character', id.get(\"represents\"));","\t\t\t\tvar aSet = findObjs({_type: \"attribute\",name: leng + \"_WEAPpay\",_characterid: cWho.id} , {caseInsensitive: true})[0];","\t\t\t\tif (aSet == undefined){","\t\t\t\t\taSet = FindGun;","\t\t\t\t}","\t\t\t\taSet = aSet.id;","\t\t\t\tid.set(\"bar3_link\", aSet);","\t\t\t\tid.set('bar3_value', cAmmo);","\t\t\t\tid.set('bar3_max', mAmmo);","\t\t\t});","\t\t\tvar aPart = \"<div style='box-shadow: \"+bShadow+\"; font-family: \"+font+\"; font-size: 8pt; text-align: center; margin:0px; padding:0px 0px 0px 0px; border-left: 1px solid #000; border-right: 1px solid #000; border-top: 1px solid #000; border-radius: 0px; color: #000;\";","\t\t\tif (mAmmo == 0) {}","\t\t\telse if (cAmmo <= 0 || cAmmo < ammoC) {","\t\t\t\tcAmmo = \"0\";","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tMain = aPart + \"background-color:RED;'><b><i>Not Enough \" + gun + \" ammo left in clip.</div>\";","\t\t\t}","\t\t\telse if (cAmmo <= 3 || cAmmo < ammoC) {","\t\t\t\tcAmmo = cAmmo - ammoC;","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tvar per = (cAmmo/mAmmo)*100;","\t\t\t\tvar ammoT = '<div style=\"border: 2px solid #333; background-color: #0D0D0D; border-radius: 13px; padding: 3px;\"><div style=\"background-color: red; width: '+per+'%; height: 5px; border-radius: 10px;\"></div></div>';","\t\t\t\tMain = Main + aPart + \"background-color:RED;'><b><i>\" + cAmmo + \" \" + gun + \" ammo left in clip.</b></i>\"+ammoT+\"</div>\";","\t\t\t} ","\t\t\telse {","\t\t\t\tcAmmo = cAmmo - ammoC;","\t\t\t\tammo0.set('current', cAmmo);","\t\t\t\tvar per = (cAmmo/mAmmo)*100;","\t\t\t\tvar ammoT = '<div style=\"border: 2px solid #333; background-color: #0D0D0D; border-radius: 13px; padding: 1px;\"><div style=\"background-color: orange; width: '+per+'%; height: 3px; border-radius: 10px; margins: 0px;\"></div></div>';","\t\t\t\tMain = Main + aPart + \"background-color:#A8A191;'><b><i>\" + cAmmo + \" of \" + mAmmo + \" \" + gun + \" ammo left</b></i>\"+ammoT+\"</div>\";","\t\t\t}","\t\t}","\t\t/*-----------","SEND CHAT","-----------*/","\t\tvar pad = \"6px;\";","\t\tif (bText != \"\") pad = \"2px;\";","\t\tvar top = \"<div style='\"+bg_crit+\" box-shadow: \"+bShadow+\"; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 2px 2px #000; font-family: \"+font+\"; text-align: center; vertical-align: middle; padding: 0px 0px; margin-top: 0.2em; border: 1px solid #000; border-radius: 10px 10px 0px 0px; color: #FFFFFF; background-color:\" + boxcolor + \";'><b>\" + who + \"  Attacks</b></div>\";","\t\tEnd = \"<div style='\"+bg_crit+\" box-shadow: \"+bShadow+\"; text-shadow: -1px -1px #000, 1px -1px #000, -1px 1px #000, 2px 2px #000; font-family: \"+font+\"; font-size: 16px ;text-align: center; padding: \"+pad+\" vertical-align: middle; border: 1px solid #000; border-radius: 0px 0px 8px 8px; color: #FFFFFF; background-color:\" + boxcolor+ \";'><b>\"  + bText + \"</div>\";","\t\tvar SendT = top + Main + End;","\t\tif (aRollraw <= 3 && fumble != 1) {","\t\t\tSendT = \"<div style='opacity: 0.5;'><strong style='font-size: 70%;'>\" + SendT + \"</strong></div>\";","\t\t}","\t\tif (aRollraw >=20) {","\t\t\tSendT = \"<strong style='font-size: 120%;'>\" + SendT + \"</strong>\";","\t\t}","\t\tsendChat(who, '/direct ' + SendT);","\t\treturn;","\t}","//\t-----------------------------","//\tRELOAD----------------","//\t-----------------------------","\tif (command == \"!reload\") {","\t\tif (cWho !== undefined) {","\t\t\tvar msgFormula = msgTxt.split(\" --\");","\t\t\tvar gun = msgFormula[1];","\t\t\tvar FindGun = findObjs({current: gun, type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tif (FindGun == undefined) {","\t\t\t\tsendChat('', '/desc '+msg.who+': <b>ammo not found</b>');","\t\t\t\treturn","\t\t\t}","\t\t\tClips = 0;","\t\t\tvar attName = FindGun.get(\"name\");","\t\t\tvar Ammo0 = findObjs({name: attName + \"pay\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tvar Ammo1 = findObjs({name: attName + \"Rounds\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tvar Clipsc = findObjs({name: attName + \"clip\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","\t\t\tif(Clipsc != undefined) {","\t\t\t\tvar Clips = parseInt(Clipsc.get(\"current\"));                ","\t\t\t}","\t\t\tvar cWep = parseInt(Ammo0.get(\"current\"));","\t\t\tvar mWep = parseInt(Ammo0.get(\"max\"));","\t\t\tvar cAmmo = parseInt(Ammo1.get(\"current\"));","\t\t\tif (cAmmo <= 0) {","\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>● \" +msg.who+ ' NO AMMO TO RELOAD!</div>';","\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t}","\t\t\telse {                ","\t\t\t\tvar needed = mWep - cWep;                ","\t\t\t\tif(needed >= cAmmo) {needed = cAmmo;}","\t\t\t\tif (Clips == 10) {","\t\t\t\t\tneeded = 1;","\t\t\t\t\tcAmmo = cAmmo - needed;","\t\t\t\t\tvar reloads = cAmmo;","\t\t\t\t\tAmmo0.set('current', mWep);","\t\t\t\t\tAmmo1.set('current', cAmmo);","\t\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>● \" +msg.who+ ' is reloading: '+needed +\" clips on:<br>● \"+ msgFormula[1] +' ●<br>'+ cAmmo + ' left(' + reloads + 'Clips)</div>';","\t\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t\t}","\t\t\t\telse {","\t\t\t\t\tcAmmo = cAmmo - needed;","\t\t\t\t\tvar reloads = Math.round((cAmmo / mWep) * 10) / 10;\t\t\t\t","\t\t\t\t\tAmmo0.set('current', cWep+needed);","\t\t\t\t\tAmmo1.set('current', cAmmo);","\t\t\t\t\tvar help = OuterDiv+iPart + \"background-color:#A80000;'><b>\" +msg.who+ ' is reloading '+needed +\" Ammo on:<br>● \"+ msgFormula[1] +' ●<br>'+ cAmmo + ' left(' + reloads + ' reloads)</div>';","\t\t\t\t\tsendChat('', '/direct ' + help);","\t\t\t\t}","\t\t\t}","\t\t}","\t}","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":15,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":3},"end":{"row":15,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":15,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":5},"end":{"row":15,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":2},"end":{"row":18,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":3},"end":{"row":18,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":5},"end":{"row":18,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":2},"end":{"row":19,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":3},"end":{"row":19,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":4},"end":{"row":19,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":5},"end":{"row":19,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":11},"end":{"row":7,"column":12},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":2},"end":{"row":26,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":2},"end":{"row":27,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":2},"end":{"row":28,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":29,"column":2},"end":{"row":29,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":30,"column":2},"end":{"row":30,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":2},"end":{"row":31,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":2},"end":{"row":32,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":2},"end":{"row":33,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":2},"end":{"row":34,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":2},"end":{"row":35,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":2},"end":{"row":36,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":2},"end":{"row":38,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":39,"column":2},"end":{"row":39,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":2},"end":{"row":40,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":2},"end":{"row":42,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":2},"end":{"row":41,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":2},"end":{"row":43,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":1},"end":{"row":44,"column":5},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":5},"end":{"row":44,"column":6},"action":"remove","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":1},"end":{"row":44,"column":2},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":1,"column":51},"action":"remove","lines":["//!attack --[[1d20]] --[[3d6]] --saying! --ammotype"]}]}],[{"group":"doc","deltas":[{"start":{"row":1,"column":0},"end":{"row":2,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":54,"column":57},"end":{"row":54,"column":58},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":3},"end":{"row":64,"column":6},"action":"remove","lines":["var"]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":3},"end":{"row":64,"column":4},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":67,"column":4},"end":{"row":67,"column":8},"action":"remove","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":73,"column":16},"end":{"row":73,"column":17},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":86,"column":26},"end":{"row":86,"column":27},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":2},"end":{"row":97,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":99,"column":2},"end":{"row":99,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":2},"end":{"row":100,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":11},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":41},"end":{"row":103,"column":45},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":106,"column":2},"end":{"row":106,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":108,"column":2},"end":{"row":108,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":109,"column":2},"end":{"row":109,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":3},"end":{"row":113,"column":7},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":114,"column":3},"end":{"row":114,"column":7},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":3},"end":{"row":115,"column":7},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":117,"column":47},"end":{"row":117,"column":51},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":122,"column":2},"end":{"row":122,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":60},"end":{"row":0,"column":68},"action":"insert","lines":["crit_img"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":68},"end":{"row":0,"column":69},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":153,"column":4},"end":{"row":153,"column":5},"action":"remove","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":143,"column":2},"end":{"row":143,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":143,"column":3},"end":{"row":143,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":143,"column":4},"end":{"row":143,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":143,"column":5},"end":{"row":143,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":2},"end":{"row":148,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":3},"end":{"row":148,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":4},"end":{"row":148,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":5},"end":{"row":148,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":141,"column":2},"end":{"row":141,"column":6},"action":"insert","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":45},"end":{"row":0,"column":49},"action":"insert","lines":["aLoc"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":49},"end":{"row":0,"column":50},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":45},"end":{"row":0,"column":49},"action":"insert","lines":["aFum"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":49},"end":{"row":0,"column":50},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":165,"column":3},"end":{"row":165,"column":7},"action":"remove","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":166,"column":3},"end":{"row":166,"column":7},"action":"remove","lines":["var "]}]}],[{"group":"doc","deltas":[{"start":{"row":169,"column":0},"end":{"row":170,"column":38},"action":"remove","lines":["            //var acAbilityAttribute = getAttrByName(cWho.id, 'ISP'); // \"@{strength-mod}\"","            //log(acAbilityAttribute);"]}]}],[{"group":"doc","deltas":[{"start":{"row":169,"column":0},"end":{"row":170,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":82,"column":0},"end":{"row":85,"column":53},"action":"remove","lines":["\t\t\t\t//var bonus = findObjs({name: leng + \"_WEAPb\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var bonus = parseInt(bonus.get(\"current\"));","                //var damage = findObjs({name: leng + \"_WEAPd\", type: \"attribute\",_characterid: cWho.id}, {caseInsensitive: true})[0];","                //var damage = damage.get(\"current\");"]}]}],[{"group":"doc","deltas":[{"start":{"row":82,"column":0},"end":{"row":83,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":300,"scrollleft":0,"selection":{"start":{"row":162,"column":51},"end":{"row":162,"column":51},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":20,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1421142445000,"hash":"00acbccdcf990fcab66d7b4ec09539b9e927cb9d"}